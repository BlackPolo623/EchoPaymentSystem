<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª æ¨¡æ“¬é‡‘æµ POST æ¸¬è©¦ - Echo Payment</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body {
            cursor: auto !important;
            padding: 20px;
            display: block;
        }
        body::before, body::after {
            opacity: 0.2;
        }
        .test-container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 30px;
        }
        .test-title {
            font-family: 'Orbitron', sans-serif;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 30px;
        }
        .warning-box {
            background: rgba(255, 170, 0, 0.1);
            border: 1px solid var(--warning-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
            color: var(--warning-color);
        }
        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
        }
        .preset-btn {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid var(--success-color);
            color: var(--success-color);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Rajdhani', sans-serif;
            transition: all 0.3s ease;
        }
        .preset-btn:hover {
            background: rgba(0, 255, 136, 0.3);
            transform: translateY(-2px);
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 5px;
            font-size: 13px;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 13px;
        }
        .form-group small {
            color: var(--text-muted);
            font-size: 11px;
        }
        .submit-btn {
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.3), rgba(0, 212, 255, 0.2));
            border: 1px solid var(--primary-color);
            color: var(--text-primary);
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            margin-right: 10px;
            transition: all 0.3s ease;
        }
        .submit-btn:hover {
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.4), rgba(0, 212, 255, 0.3));
            transform: translateY(-2px);
        }
        .result-box {
            margin-top: 25px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            display: none;
        }
        .result-box h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        .result-box code {
            display: block;
            padding: 10px;
            background: var(--bg-darker);
            border-radius: 5px;
            color: var(--accent-color);
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
<div class="test-container">
    <h1 class="test-title">ğŸ§ª æ¨¡æ“¬é‡‘æµ POST æ¸¬è©¦</h1>

    <div class="warning-box">
        <strong>âš ï¸ æ³¨æ„ï¼š</strong>é€™å€‹é é¢åƒ…ç”¨æ–¼æ¸¬è©¦ï¼Œä½¿ç”¨å®Œè«‹åˆªé™¤ï¼
    </div>

    <div class="preset-buttons">
        <h3 style="width: 100%; color: var(--text-secondary); margin-bottom: 10px;">å¿«é€Ÿé è¨­ï¼š</h3>
        <button class="preset-btn" onclick="setATMSuccess()">ATM ä»˜æ¬¾æˆåŠŸ</button>
        <button class="preset-btn" onclick="setCreditSuccess()">ä¿¡ç”¨å¡ä»˜æ¬¾æˆåŠŸ</button>
        <button class="preset-btn" onclick="setATMFailed()">ATM ä»˜æ¬¾å¤±æ•—</button>
        <button class="preset-btn" onclick="setSimulate()">æ¨¡æ“¬ä»˜æ¬¾</button>
    </div>

    <form id="testForm">
        <div class="form-grid">
            <div class="form-group">
                <label>ç›®æ¨™ PHP æª”æ¡ˆï¼š</label>
                <select id="targetUrl">
                    <option value="php/atm_payment_notify.php">ATM ä»˜æ¬¾é€šçŸ¥</option>
                    <option value="php/funpoint_payment_notify.php">ä¿¡ç”¨å¡ä»˜æ¬¾é€šçŸ¥</option>
                </select>
            </div>

            <div class="form-group">
                <label>MerchantIDï¼š</label>
                <input type="text" id="MerchantID" value="1020977">
            </div>

            <div class="form-group">
                <label>MerchantTradeNoï¼š</label>
                <input type="text" id="MerchantTradeNo" value="ECHO20250731001">
            </div>

            <div class="form-group">
                <label>RtnCode (1=æˆåŠŸ, å…¶ä»–=å¤±æ•—)ï¼š</label>
                <input type="text" id="RtnCode" value="1">
            </div>

            <div class="form-group">
                <label>RtnMsgï¼š</label>
                <input type="text" id="RtnMsg" value="äº¤æ˜“æˆåŠŸ">
            </div>

            <div class="form-group">
                <label>TradeNoï¼š</label>
                <input type="text" id="TradeNo" value="202507311234567890">
            </div>

            <div class="form-group">
                <label>TradeAmtï¼š</label>
                <input type="number" id="TradeAmt" value="500">
            </div>

            <div class="form-group">
                <label>PaymentDateï¼š</label>
                <input type="text" id="PaymentDate" value="">
            </div>

            <div class="form-group">
                <label>PaymentTypeï¼š</label>
                <input type="text" id="PaymentType" value="ATM_CHINATRUST">
            </div>

            <div class="form-group">
                <label>CustomField1ï¼š</label>
                <input type="text" id="CustomField1" value="ECHO_TEST_ORDER">
            </div>

            <div class="form-group">
                <label>SimulatePaid (1=æ¨¡æ“¬, 0=çœŸå¯¦)ï¼š</label>
                <input type="text" id="SimulatePaid" value="1">
            </div>

            <div class="form-group">
                <label>CheckMacValueï¼š</label>
                <input type="text" id="CheckMacValue" value="TEST_CHECKSUM_VALUE">
                <small>è¨»ï¼šå¯¦éš›æ¸¬è©¦æ™‚éœ€è¦æ­£ç¢ºçš„æª¢æŸ¥ç¢¼</small>
            </div>
        </div>

        <div style="margin-top: 25px;">
            <button type="button" class="submit-btn" onclick="sendTestData()">ç™¼é€æ¸¬è©¦è³‡æ–™</button>
            <button type="button" class="submit-btn" onclick="generateCurrentTime()">ç”Ÿæˆç•¶å‰æ™‚é–“</button>
        </div>
    </form>

    <div id="result" class="result-box">
        <h3>å›æ‡‰çµæœï¼š</h3>
        <div id="responseContent"></div>
    </div>
</div>

<script>
    function generateCurrentTime() {
        const now = new Date();
        const timeStr = now.getFullYear() + '/' +
                      (now.getMonth() + 1).toString().padStart(2, '0') + '/' +
                      now.getDate().toString().padStart(2, '0') + ' ' +
                      now.getHours().toString().padStart(2, '0') + ':' +
                      now.getMinutes().toString().padStart(2, '0') + ':' +
                      now.getSeconds().toString().padStart(2, '0');
        document.getElementById('PaymentDate').value = timeStr;
    }

    function setATMSuccess() {
        document.getElementById('targetUrl').value = 'php/atm_payment_notify.php';
        document.getElementById('MerchantTradeNo').value = 'ECHO' + Date.now();
        document.getElementById('RtnCode').value = '1';
        document.getElementById('RtnMsg').value = 'äº¤æ˜“æˆåŠŸ';
        document.getElementById('PaymentType').value = 'ATM_CHINATRUST';
        document.getElementById('SimulatePaid').value = '1';
        generateCurrentTime();
    }

    function setCreditSuccess() {
        document.getElementById('targetUrl').value = 'php/funpoint_payment_notify.php';
        document.getElementById('MerchantTradeNo').value = 'ECHO' + Date.now();
        document.getElementById('RtnCode').value = '1';
        document.getElementById('RtnMsg').value = 'äº¤æ˜“æˆåŠŸ';
        document.getElementById('PaymentType').value = 'Credit_CreditCard';
        document.getElementById('SimulatePaid').value = '1';
        generateCurrentTime();
    }

    function setATMFailed() {
        document.getElementById('targetUrl').value = 'php/atm_payment_notify.php';
        document.getElementById('MerchantTradeNo').value = 'ECHO' + Date.now();
        document.getElementById('RtnCode').value = '0';
        document.getElementById('RtnMsg').value = 'ä»˜æ¬¾å¤±æ•—';
        document.getElementById('PaymentType').value = 'ATM_CHINATRUST';
        document.getElementById('SimulatePaid').value = '1';
        generateCurrentTime();
    }

    function setSimulate() {
        document.getElementById('MerchantTradeNo').value = 'ECHO' + Date.now();
        document.getElementById('RtnCode').value = '1';
        document.getElementById('RtnMsg').value = 'æ¨¡æ“¬ä»˜æ¬¾æˆåŠŸ';
        document.getElementById('SimulatePaid').value = '1';
        generateCurrentTime();
    }

    async function sendTestData() {
        const targetUrl = document.getElementById('targetUrl').value;

        const formData = new FormData();
        const fields = [
            'MerchantID', 'MerchantTradeNo', 'RtnCode', 'RtnMsg',
            'TradeNo', 'TradeAmt', 'PaymentDate', 'PaymentType',
            'CustomField1', 'SimulatePaid', 'CheckMacValue'
        ];

        fields.forEach(field => {
            const value = document.getElementById(field).value;
            if (value) {
                formData.append(field, value);
            }
        });

        console.log('ç™¼é€è³‡æ–™åˆ°:', targetUrl);

        try {
            const response = await fetch(targetUrl, {
                method: 'POST',
                body: formData
            });

            const responseText = await response.text();

            document.getElementById('result').style.display = 'block';
            document.getElementById('responseContent').innerHTML = `
                <p><strong>HTTP ç‹€æ…‹:</strong> ${response.status}</p>
                <p><strong>å›æ‡‰å…§å®¹:</strong></p>
                <code>${responseText}</code>
                <p><strong>æ™‚é–“:</strong> ${new Date().toLocaleString()}</p>
            `;

            console.log('å›æ‡‰:', responseText);

        } catch (error) {
            document.getElementById('result').style.display = 'block';
            document.getElementById('responseContent').innerHTML = `
                <p style="color: var(--error-color);"><strong>éŒ¯èª¤:</strong> ${error.message}</p>
            `;
            console.error('è«‹æ±‚å¤±æ•—:', error);
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        generateCurrentTime();
    });
</script>
</body>
</html>
