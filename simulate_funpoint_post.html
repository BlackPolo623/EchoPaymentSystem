<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ“¬æ­è²·å°¬é‡‘æµ POST æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a87; }
        .preset-buttons { margin-bottom: 20px; }
        .preset-buttons button { margin-right: 10px; margin-bottom: 10px; background: #28a745; }
        .result { margin-top: 20px; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ§ª æ¨¡æ“¬æ­è²·å°¬é‡‘æµ POST æ¸¬è©¦</h1>

    <div class="warning">
        <strong>âš ï¸ æ³¨æ„ï¼š</strong>é€™å€‹é é¢åƒ…ç”¨æ–¼æ¸¬è©¦ï¼Œä½¿ç”¨å®Œè«‹åˆªé™¤ï¼
    </div>

    <div class="preset-buttons">
        <h3>å¿«é€Ÿé è¨­è³‡æ–™ï¼š</h3>
        <button onclick="setATMSuccess()">ATM ä»˜æ¬¾æˆåŠŸ</button>
        <button onclick="setCreditSuccess()">ä¿¡ç”¨å¡ä»˜æ¬¾æˆåŠŸ</button>
        <button onclick="setATMFailed()">ATM ä»˜æ¬¾å¤±æ•—</button>
        <button onclick="setSimulate()">æ¨¡æ“¬ä»˜æ¬¾</button>
    </div>

    <form id="testForm">
        <div class="form-group">
            <label>ç›®æ¨™ PHP æª”æ¡ˆï¼š</label>
            <select id="targetUrl">
                <option value="atm_payment_notify.php">ATM ä»˜æ¬¾é€šçŸ¥</option>
                <option value="funpoint_payment_notify.php">ä¿¡ç”¨å¡ä»˜æ¬¾é€šçŸ¥</option>
                <option value="test_receive.php">ç°¡å–®æ¸¬è©¦æª”æ¡ˆ</option>
            </select>
        </div>

        <div class="form-group">
            <label>MerchantIDï¼š</label>
            <input type="text" id="MerchantID" value="1020977">
        </div>

        <div class="form-group">
            <label>MerchantTradeNoï¼š</label>
            <input type="text" id="MerchantTradeNo" value="TEST20250731001">
        </div>

        <div class="form-group">
            <label>RtnCode (1=æˆåŠŸ, å…¶ä»–=å¤±æ•—)ï¼š</label>
            <input type="text" id="RtnCode" value="1">
        </div>

        <div class="form-group">
            <label>RtnMsgï¼š</label>
            <input type="text" id="RtnMsg" value="äº¤æ˜“æˆåŠŸ">
        </div>

        <div class="form-group">
            <label>TradeNoï¼š</label>
            <input type="text" id="TradeNo" value="202507311234567890">
        </div>

        <div class="form-group">
            <label>TradeAmtï¼š</label>
            <input type="number" id="TradeAmt" value="500">
        </div>

        <div class="form-group">
            <label>PaymentDateï¼š</label>
            <input type="text" id="PaymentDate" value="">
        </div>

        <div class="form-group">
            <label>PaymentTypeï¼š</label>
            <input type="text" id="PaymentType" value="ATM_CHINATRUST">
        </div>

        <div class="form-group">
            <label>CustomField1 (ç”¨æˆ¶å¸³è™Ÿ)ï¼š</label>
            <input type="text" id="CustomField1" value="testuser">
        </div>

        <div class="form-group">
            <label>SimulatePaid (1=æ¨¡æ“¬, 0=çœŸå¯¦)ï¼š</label>
            <input type="text" id="SimulatePaid" value="1">
        </div>

        <div class="form-group">
            <label>CheckMacValueï¼š</label>
            <input type="text" id="CheckMacValue" value="TEST_CHECKSUM_VALUE">
            <small>è¨»ï¼šå¯¦éš›æ¸¬è©¦æ™‚éœ€è¦æ­£ç¢ºçš„æª¢æŸ¥ç¢¼</small>
        </div>

        <button type="button" onclick="sendTestData()">ç™¼é€æ¸¬è©¦è³‡æ–™</button>
        <button type="button" onclick="generateCurrentTime()">ç”Ÿæˆç•¶å‰æ™‚é–“</button>
    </form>

    <div id="result" class="result" style="display:none;">
        <h3>å›æ‡‰çµæœï¼š</h3>
        <div id="responseContent"></div>
    </div>
</div>

<script>
    // ç”Ÿæˆç•¶å‰æ™‚é–“
    function generateCurrentTime() {
        const now = new Date();
        const timeStr = now.getFullYear() + '/' +
                      (now.getMonth() + 1).toString().padStart(2, '0') + '/' +
                      now.getDate().toString().padStart(2, '0') + ' ' +
                      now.getHours().toString().padStart(2, '0') + ':' +
                      now.getMinutes().toString().padStart(2, '0') + ':' +
                      now.getSeconds().toString().padStart(2, '0');
        document.getElementById('PaymentDate').value = timeStr;
    }

    // é è¨­ ATM æˆåŠŸè³‡æ–™
    function setATMSuccess() {
        document.getElementById('targetUrl').value = 'atm_payment_notify.php';
        document.getElementById('MerchantTradeNo').value = 'ATM' + Date.now();
        document.getElementById('RtnCode').value = '1';
        document.getElementById('RtnMsg').value = 'äº¤æ˜“æˆåŠŸ';
        document.getElementById('PaymentType').value = 'ATM_CHINATRUST';
        document.getElementById('SimulatePaid').value = '1';
        generateCurrentTime();
    }

    // é è¨­ä¿¡ç”¨å¡æˆåŠŸè³‡æ–™
    function setCreditSuccess() {
        document.getElementById('targetUrl').value = 'funpoint_payment_notify.php';
        document.getElementById('MerchantTradeNo').value = 'HE' + Date.now();
        document.getElementById('RtnCode').value = '1';
        document.getElementById('RtnMsg').value = 'äº¤æ˜“æˆåŠŸ';
        document.getElementById('PaymentType').value = 'Credit_CreditCard';
        document.getElementById('SimulatePaid').value = '1';
        generateCurrentTime();
    }

    // é è¨­ ATM å¤±æ•—è³‡æ–™
    function setATMFailed() {
        document.getElementById('targetUrl').value = 'atm_payment_notify.php';
        document.getElementById('MerchantTradeNo').value = 'ATM' + Date.now();
        document.getElementById('RtnCode').value = '0';
        document.getElementById('RtnMsg').value = 'ä»˜æ¬¾å¤±æ•—';
        document.getElementById('PaymentType').value = 'ATM_CHINATRUST';
        document.getElementById('SimulatePaid').value = '1';
        generateCurrentTime();
    }

    // é è¨­æ¨¡æ“¬ä»˜æ¬¾è³‡æ–™
    function setSimulate() {
        document.getElementById('MerchantTradeNo').value = 'SIM' + Date.now();
        document.getElementById('RtnCode').value = '1';
        document.getElementById('RtnMsg').value = 'æ¨¡æ“¬ä»˜æ¬¾æˆåŠŸ';
        document.getElementById('SimulatePaid').value = '1';
        generateCurrentTime();
    }

    // ç™¼é€æ¸¬è©¦è³‡æ–™
    async function sendTestData() {
        const targetUrl = document.getElementById('targetUrl').value;

        // æ”¶é›†æ‰€æœ‰è¡¨å–®è³‡æ–™
        const formData = new FormData();
        const fields = [
            'MerchantID', 'MerchantTradeNo', 'RtnCode', 'RtnMsg',
            'TradeNo', 'TradeAmt', 'PaymentDate', 'PaymentType',
            'CustomField1', 'SimulatePaid', 'CheckMacValue'
        ];

        fields.forEach(field => {
            const value = document.getElementById(field).value;
            if (value) {
                formData.append(field, value);
            }
        });

        // é¡¯ç¤ºç™¼é€çš„è³‡æ–™
        console.log('ç™¼é€è³‡æ–™åˆ°:', targetUrl);
        for (let [key, value] of formData.entries()) {
            console.log(key, ':', value);
        }

        try {
            const response = await fetch(targetUrl, {
                method: 'POST',
                body: formData
            });

            const responseText = await response.text();

            // é¡¯ç¤ºçµæœ
            document.getElementById('result').style.display = 'block';
            document.getElementById('responseContent').innerHTML = `
                <strong>HTTP ç‹€æ…‹:</strong> ${response.status}<br>
                <strong>å›æ‡‰å…§å®¹:</strong> <code>${responseText}</code><br>
                <strong>æ™‚é–“:</strong> ${new Date().toLocaleString()}
            `;

            console.log('å›æ‡‰:', responseText);

        } catch (error) {
            document.getElementById('result').style.display = 'block';
            document.getElementById('responseContent').innerHTML = `
                <strong style="color: red;">éŒ¯èª¤:</strong> ${error.message}
            `;
            console.error('è«‹æ±‚å¤±æ•—:', error);
        }
    }

    // é é¢è¼‰å…¥æ™‚ç”Ÿæˆç•¶å‰æ™‚é–“
    document.addEventListener('DOMContentLoaded', function() {
        generateCurrentTime();
    });
</script>
</body>
</html>